/*
 * jQuery Scrollable
 *
 * Copyright (c) 2012 Mike Cao <mike@mikecao.com>
 * License under the MIT license
 */(function(e,t,n,r){function s(e){return e+.5<<0}function o(t){e.browser.mozilla?t.css("MozUserSelect","none"):e.browser.msie?t.bind("selectstart",function(){return!1}):t.mousedown(function(){return!1})}function u(t){e.browser.mozilla?t.css("MozUserSelect","text"):e.browser.msie?t.unbind("selectstart"):t.unbind("mousedown")}function a(e){this.base=e.base,this.scrollbar=e,this.init()}function f(e,t){this.base=e.base,this.scrollbar=e,this.type=t,this.init()}function l(e){this.base=e.base,this.scrollbar=e,this.init()}function c(e,t){this.base=e,this.type=t,this.enabled=!0,this.init()}function h(t){this.base=t,this.content=e(t.target),this.init()}function p(t,n){this.target=t,this.options=e.extend({},i,n),this.init()}var i={width:200,height:200,showButtons:!0,buttonSpeed:20,minSliderSize:10,animate:!1,scrollSpeed:300,mousewheel:!0,mousewheelSpeed:30,overlay:!1,fadeSpeed:300,className:""};a.prototype.init=function(){var t=this;this.element=e("<div/>").addClass("slider").appendTo(this.scrollbar.track.element),this.element.bind("mousedown.scrollable",function(e){t.enableMouse(e.clientX,e.clientY)})},a.prototype.enableMouse=function(t,r){var i=this,s=this.element.position();this.scrollbar.element.addClass("active"),o(this.base.view.content),e(n).bind("mouseup.scrollable",function(e){i.disableMouse(e)}),e(n).bind("mousemove.scrollable",function(e){i.sliderMouseMove(i.scrollbar.type==="horizontal"?e.clientX-t+s.left:e.clientY-r+s.top)})},a.prototype.disableMouse=function(t){e(n).unbind("mousemove.scrollable").unbind(t),this.scrollbar.element.removeClass("active"),u(this.base.view.content)},a.prototype.sliderMouseMove=function(e){this.scrollbar.slider.moveTo(e,!1)},a.prototype.moveTo=function(e,t){var n=this.base.view.size()[this.scrollbar.unit],i=this.scrollbar.track.length(),s=this.scrollbar.origin;e<0?e=0:e>i&&(e=i),this.element.css(s,e+"px"),this.base.view.moveTo(s==="left"?-1*n*(e/i):r,s==="top"?-1*n*(e/i):r,t!==r?t:this.base.options.animate)},f.prototype.init=function(){var t=this;this.element=e("<div/>").addClass("button").addClass(this.type).appendTo(this.scrollbar.element),this.element.click(function(e){t.buttonClick(e)})},f.prototype.buttonClick=function(e){var t=this.scrollbar.slider,n=this.base.options.buttonSpeed,r=t.element.position()[this.scrollbar.origin];switch(this.type){case"top":t.moveTo(r-n);break;case"bottom":t.moveTo(r+n);break;case"left":t.moveTo(r-n);break;case"right":t.moveTo(r+n)}},l.prototype.init=function(){var t=this;this.element=e("<div/>").addClass("track").width(this.scrollbar.element.outerWidth()).height(this.scrollbar.element.outerHeight()).appendTo(this.scrollbar.element),this.element.click(function(e){t.trackClick(t.scrollbar.type==="vertical"?e.pageY:e.pageX)})},l.prototype.trackClick=function(e){var t=this.scrollbar.slider.element,n=this.scrollbar.origin,r=this.scrollbar.measure;e<t.offset()[n]?this.scrollbar.slider.moveTo(t.position()[n]-t[r]()):e>t.offset()[n]+t[r]()&&this.scrollbar.slider.moveTo(t.position()[n]+t[r]())},l.prototype.length=function(){return this.scrollbar.type==="vertical"?this.element.outerHeight()-this.scrollbar.slider.element.outerHeight():this.element.outerWidth()-this.scrollbar.slider.element.outerWidth()},c.prototype.init=function(){var t=this;this.element=e("<div/>").addClass("bar").addClass(this.type).appendTo(this.base.element),o(this.element),this.track=new l(this),this.type=="vertical"?(this.button1=new f(this,"top"),this.button2=new f(this,"bottom")):this.type=="horizontal"&&(this.button1=new f(this,"left"),this.button2=new f(this,"right")),this.slider=new a(this);switch(this.type){case"horizontal":this.origin="left",this.unit="width",this.measure="outerWidth";break;case"vertical":this.origin="top",this.unit="height",this.measure="outerHeight"}},c.prototype.update=function(){this.element[this.enabled?"show":"hide"]();if(!this.enabled)return;var e=this.base.view,t=this.unit,n=this.measure,r=this.base.options,i=r.showButtons?"show":"hide",o=this.type==="vertical"?this.base.hbar:this.base.vbar;this.base.options.overlay?(this.element.addClass("overlay"),o.enabled&&this.element[t](e.element[t]()-o.element[t]())):this.element[t](e.element[t]()),this.button1.element[i](),this.button2.element[i](),r.showButtons?(this.track.element.css(this.origin,this.button1.element[n]()+"px"),this.track.element[t](e.element[n]()-this.button1.element[n]()*2)):this.track.element[t](e.element[n]());var u=s(this.element[t]()/e.content[t]()*this.track.element[t]());this.slider.element[this.unit](u>r.minSliderSize?u:r.minSliderSize)},h.prototype.init=function(){this.element=this.content.wrap('<div class="view"></div>').parent().width(this.base.options.width).height(this.base.options.height),this.content.css({position:"absolute",top:0,left:0})},h.prototype.update=function(){var e=this.base.vbar.element,t=this.base.hbar.element;this.base.options.overlay||(this.base.vbar.enabled&&this.element.width(this.base.element.outerWidth()-e.outerWidth()),this.base.hbar.enabled&&this.element.height(this.base.element.outerHeight()-t.outerHeight())),!this.base.vbar.enabled&&!this.base.hbar.enabled&&this.moveTo(0,0,!1)},h.prototype.moveTo=function(e,t,n){var i={};e!==r&&(i.left=e+"px"),t!==r&&(i.top=t+"px"),n?this.content.stop(!0,!1).animate(i,this.base.options.scrollSpeed):this.content.css(i)},h.prototype.size=function(){return{width:this.content.outerWidth()-this.element.outerWidth(),height:this.content.outerHeight()-this.element.outerHeight()}},p.prototype.init=function(){this.element=e(this.target).wrap('<div class="scrollable"></div>').parent().addClass(this.options.className).width(this.options.width).height(this.options.height),this.view=new h(this),this.vbar=new c(this,"vertical"),this.hbar=new c(this,"horizontal"),this.update()},p.prototype.update=function(t){var n=this;this.options=e.extend({},this.options,t),this.element.width(this.options.width).height(this.options.height),this.view.element.width(this.options.width).height(this.options.height),this.vbar.enabled=this.view.content.height()>this.element.height(),this.hbar.enabled=this.view.content.width()>this.element.width(),this.view.update(),this.vbar.update(),this.hbar.update(),this.options.mousewheel?this.element.unbind("mousewheel").bind("mousewheel",function(e,t,r,i){n.mouseScroll(e,t,r,i)}):this.element.unbind("mousewheel"),this.options.overlay?this.element.hover(function(){n.vbar.enabled&&n.vbar.element.fadeIn(n.options.fadeSpeed),n.hbar.enabled&&n.hbar.element.fadeIn(n.options.fadeSpeed)},function(){n.vbar.enabled&&n.vbar.element.fadeOut(n.options.fadeSpeed),n.hbar.enabled&&n.hbar.element.fadeOut(n.options.fadeSpeed)}):this.element.unbind("mouseenter mouseleave")},p.prototype.mouseScroll=function(e,t,n,r){var i=this.vbar.slider.element.position(),s=this.hbar.slider.element.position();r!==0&&this.vbar.enabled&&this.vbar.slider.moveTo(i.top-this.options.mousewheelSpeed*r,!1),n!==0&&this.hbar.enabled&&this.hbar.slider.moveTo(s.left+this.options.mousewheelSpeed*n,!1),e.preventDefault()},e.fn.scrollable=function(t){return this.each(function(){var n=e(this),i=n.data("scrollable");i===r?n.data("scrollable",new p(this,t)):i.update(t)})}})(jQuery,window,document);